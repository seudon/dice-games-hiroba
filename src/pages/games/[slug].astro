---
// src/pages/games/[slug].astro
import { getCollection } from 'astro:content';
import GameLayout from '../../layouts/GameLayout.astro';
import ZoromeGame from '../../components/games/ZoromeGame.vue';
import FiftyGame from '../../components/games/FiftyGame.vue';
import QuickMathGame from '../../components/games/QuickMathGame.vue';
import DiceAdventureGame from '../../components/games/DiceAdventureGame.vue';
import ChoHanGame from '../../components/games/ChoHanGame.vue';

export async function getStaticPaths() {
  const games = await getCollection('games');
  return games.map(game => ({
    params: { slug: game.slug },
    props: { game },
  }));
}

const { game } = Astro.props;
const { Content } = await game.render();

// é›£æ˜“åº¦ã«å¿œã˜ãŸãƒãƒƒã‚¸ã‚«ãƒ©ãƒ¼
const difficultyColors: Record<string, string> = {
  'åˆç´š': 'bg-success',
  'ä¸­ç´š': 'bg-info',
  'ä¸Šç´š': 'bg-warning',
  'è¶…ç´š': 'bg-danger',
};

const baseUrl = import.meta.env.BASE_URL;
---

<GameLayout
  title={game.data.title}
  description={game.data.description}
>
  <!-- ã‚²ãƒ¼ãƒ ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="mb-4 pb-4 border-bottom">
    <h1 class="display-4 fw-bold mb-3">{game.data.title}</h1>
    <p class="lead text-dark mb-3">{game.data.description}</p>

    <!-- ãƒ¡ã‚¿æƒ…å ± -->
    <div class="d-flex flex-wrap gap-2 mb-3">
      <span class="badge bg-light text-dark">
        <span>ğŸ‘¥</span>
        <span>{game.data.players}</span>
      </span>
      <span class="badge bg-light text-dark">
        <span>â±ï¸</span>
        <span>{game.data.duration}</span>
      </span>
      <span class="badge bg-light text-dark">
        <span>ğŸ¯</span>
        <span>{game.data.difficulty}</span>
      </span>
      <span class="badge bg-light text-dark">
        <span>ğŸ²</span>
        <span>ã‚µã‚¤ã‚³ãƒ­{game.data.diceCount}å€‹</span>
      </span>
    </div>

    <!-- ã‚¿ã‚° -->
    <div class="d-flex flex-wrap gap-2">
      {game.data.category.map((cat: string) => (
        <span class={`badge ${difficultyColors[game.data.difficulty]}`}>
          {cat}
        </span>
      ))}
      {game.data.tags?.map((tag: string) => (
        <span class="badge bg-secondary">{tag}</span>
      ))}
    </div>
  </div>

  <!-- ãƒ«ãƒ¼ãƒ«èª¬æ˜(é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„) -->
  <div class="mb-4 text-dark">
    <Content />
  </div>

  <hr>

  <!-- ã‚²ãƒ¼ãƒ æœ¬ä½“(ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–) -->
  <div class="mb-4">
    <h2 class="h3 fw-bold text-center mb-4">ğŸ® ãƒ–ãƒ©ã‚¦ã‚¶ã§éŠã¶</h2>
    <div class="bg-light rounded p-4">
      {game.data.component === 'ZoromeGame.vue' && (
        <ZoromeGame
          client:visible
          gameSlug={game.slug}
          {...game.data.config}
        />
      )}
      {game.data.component === 'FiftyGame.vue' && (
        <FiftyGame
          client:visible
          gameSlug={game.slug}
        />
      )}
      {game.data.component === 'QuickMathGame.vue' && (
        <QuickMathGame
          client:visible
          gameSlug={game.slug}
        />
      )}
      {game.data.component === 'DiceAdventureGame.vue' && (
        <DiceAdventureGame
          client:visible
          gameSlug={game.slug}
        />
      )}
      {game.data.component === 'ChoHanGame.vue' && (
        <ChoHanGame
          client:visible
          gameSlug={game.slug}
        />
      )}
    </div>
  </div>

  <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
  <div class="text-center pt-3 border-top">
    <a href={`${baseUrl}/games/`} class="btn btn-primary btn-lg">
      â† ã‚²ãƒ¼ãƒ ä¸€è¦§ã«æˆ»ã‚‹
    </a>
  </div>
</GameLayout>
