---
// src/pages/games/index.astro
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import GameCard from '../../components/ui/GameCard.astro';

const allGames = await getCollection('games');

// ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°
const categories = ['é‹ã‚²ãƒ¼', 'æˆ¦ç•¥ã‚²ãƒ¼', 'è¨ˆç®—ã‚²ãƒ¼', 'ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã‚²ãƒ¼'] as const;
const gamesByCategory = categories.map(cat => ({
  name: cat,
  games: allGames.filter(g => g.data.category.includes(cat)),
})).filter(c => c.games.length > 0);

// é›£æ˜“åº¦åˆ¥ã«ã‚½ãƒ¼ãƒˆ
const gamesByDifficulty = allGames.sort((a, b) => {
  const difficultyOrder = { 'åˆç´š': 1, 'ä¸­ç´š': 2, 'ä¸Šç´š': 3, 'è¶…ç´š': 4 };
  return difficultyOrder[a.data.difficulty] - difficultyOrder[b.data.difficulty];
});
---

<BaseLayout title="ã‚²ãƒ¼ãƒ ä¸€è¦§" description="ã‚µã‚¤ã‚³ãƒ­ã‚²ãƒ¼ãƒ ã®ä¸€è¦§ãƒšãƒ¼ã‚¸">
  <!-- ãƒšãƒ¼ã‚¸ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div class="card mb-5">
    <div class="card-body text-center">
      <h1 class="display-4 fw-bold mb-3">ğŸ² ã‚²ãƒ¼ãƒ ä¸€è¦§</h1>
      <p class="lead text-dark">
        å…¨{allGames.length}ç¨®é¡ã®ã‚µã‚¤ã‚³ãƒ­ã‚²ãƒ¼ãƒ ã‚’æ²è¼‰ã—ã¦ã„ã¾ã™
      </p>
    </div>
  </div>

  <!-- ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥è¡¨ç¤º -->
  {gamesByCategory.map(({ name, games }) => (
    <div class="mb-5">
      <h2 class="h3 fw-bold mb-4 pb-2 border-start border-primary border-4 ps-3">
        {name}
      </h2>
      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {games.map(game => (
          <div class="col">
            <GameCard game={game} />
          </div>
        ))}
      </div>
    </div>
  ))}

  <!-- ã™ã¹ã¦ã®ã‚²ãƒ¼ãƒ (é›£æ˜“åº¦é †) -->
  <div class="mt-5">
    <h2 class="h3 fw-bold text-center mb-4">ã™ã¹ã¦ã®ã‚²ãƒ¼ãƒ (é›£æ˜“åº¦é †)</h2>
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      {gamesByDifficulty.map(game => (
        <div class="col">
          <GameCard game={game} />
        </div>
      ))}
    </div>
  </div>
</BaseLayout>
